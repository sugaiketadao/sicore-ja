# SQL コーディング規約

## 概要
- SQL のコーディング規約を定義します。
- 本規約に準じることで、プログラムコードの統一化と開発・保守の効率化を目指します。

## 前提条件
- "ISO/IEC 9075 Database Language SQL"（以下、標準SQL と呼ぶ）に準拠する。

## 別名
- DBテーブルには別名（エイリアス）を付加し、別名は 2～5文字とする。
- `SELECT` 文は１つの DBテーブルしか使用しない場合でも別名を付加する。
- `INSERT`・`UPDATE`・`DELETE` 文は複数DBテーブルを使用する場合のみ別名を付加する。DBMS の制限によって付加できない場合はその限りではない。
- 原則として DB項目には別名を付加しない。同じ DB項目名が複数存在する場合は適切な別名を付加する。
- DB項目に別名を付加する場合は DB項目名のサフィックスを変更しない。
    - ［NG例］ `u.user_nm creatorname`
    - ［OK例］ `u.user_nm creator_nm`
- 別名を付加する際の `AS` は省略する。
- 別名はサブクエリを含め全体を通してユニークになるよう命名する。

## テーブル結合
- 内部結合は `JOIN` で記述する。`INNER` は省略する。
- 外部結合は `LEFT JOIN` で記述する。
- 結合条件 `ON`句は、左辺に `JOIN` するテーブルを記述する。
    - ［OK例］ `FROM tbla ta JOIN tblz tz ON tz.id = ta.id`
    - ［NG例］ `FROM tbla ta JOIN tblz tz ON ta.id = tz.id`
- テーブルの結合文は標準SQL で記述する。Oracle特有の `(+)` を使用した記述方式は不可とする。

## SELECT句
- 原則として `SELECT *` は使用しない。サブクエリにて項目が指定されている場合は例外とする。
- `EXISTS` 内のサブクエリは `SELECT 1` とする。
- 抽出した全件を数えたい場合は `COUNT(*)` を使用する。（引数を `*` とする。）

## 記述ルール
- 否定演算子には `<>` を使用する。
- 暗黙の型変換は使用しない。
- 固定値はバインド変数を使用せず、SQL にリテラルで記述する。
- `GROUP BY` が使用可能であれば `DISTINCT` を使用しない。
- `null` が入らない項目に対して `COALESCE` は使用しない。
- サブクエリが不要な箇所でサブクエリを使用しない。
- 標準SQL に準拠した関数を使用する。Oracle特有の `NVL` 関数などは使用不可とする。

## スタイル
- インデントは半角スペース 2文字を使用し、タブ文字は使用しない。
- 予約語・関数名は大文字を使用する。
- 予約語・関数名以外の DBテーブル名や DB項目名、その別名は小文字を使用する。
- 演算子（`+`, `-` など）や関係演算子（`=`, `<=` など）、文字列操作（`||`）の前後には半角スペース 1文字を入れる。

- 下記の箇所の直前に改行する。
    - `SELECT`句 や `GROUP BY`句、`ORDER BY`句、`SET`句 内の `,`。
    - `FROM`, `WHERE`, `AND`, `OR`, `JOIN`, `LEFT JOIN`, `ON`。
    - `CASE` の `WHEN`, `ELSE`, `END`。
    - サブクエリ。
- 下記の箇所の直後に改行する。
    - `SELECT`, `GROUP BY`, `ORDER BY`。
    - サブクエリ。
- 下記の箇所はインデントを下げる。
    - `CASE`文の `CASE` から `END` の間。
    - サブクエリ全体。

## コメント
- コメントは Java のコード内で記載し、SQL のコメントは使用しない。
