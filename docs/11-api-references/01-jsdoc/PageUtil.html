<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PageUtil - JSDoc</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>PageUtil</h1>
      <p>フレームワーク部品 [onepg-utils.js]</p>
      <a href="index.html" class="back-link">← クラス一覧に戻る</a>
    </div>
  </div>
  <div class="main">
    <div class="section">
      <h2>クラス情報</h2>
      <div class="class-details">
        <p><strong>クラス名:</strong> PageUtil</p>
      </div>
      <div class="class-description">
        <h3>説明</h3>
        <div>ページ操作ユーティリティクラス.<br>
<ul>
  <li>ページ全体またはページのエリアを指定した操作を行う。</li>
  <li>メッセージ表示、エラー存在確認、フォームクリア、フォーム活性/非活性化、フォーム表示/非表示化などの操作を行う。</li>
  <li>一覧（繰り返し行）と明細（繰り返し行）を総称して「リスト」と呼ぶ。リストについて説明している箇所は両方に適用される。</li>
</ul></div>
      </div>
    </div>
    <div class="section">
      <h2>メソッド一覧</h2>
      <div class="method">
        <h3 id="setMsg" class="method-name">setMsg</h3>
        <div class="method-signature">
          <code>setMsg(res)</code>
        </div>
        <div class="method-description">
          メッセージ表示.<br>
<ul>
  <li>レスポンスデータからメッセージを表示する。</li>
  <li>レスポンスデータのキーは <code>'_msg'</code> とする。</li>
  <li><code>id</code>属性が <code>'_msg'</code> の要素を メッセージ表示エリア要素とする。</li>
  <li>メッセージ表示エリア要素が複数存在する場合は最初の要素に設定する。</li>
  <li>コントロールの表示制御を行う場合はページの初期処理にて <code>PageUtil#clearMsg()</code> を実行して非表示化する。</li>
  <li>レスポンスデータにメッセージが存在しない場合はメッセージ表示エリア要素のテキストをクリアする。（<code>PageUtil#clearMsg()</code> が実行される）</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>res</code></td>
                <td><code>Object</code></td>
                <td>レスポンスデータ</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="method">
        <h3 id="hasError" class="method-name">hasError</h3>
        <div class="method-signature">
          <code>hasError(res)</code>
        </div>
        <div class="method-description">
          エラー存在確認.<br>
<ul>
  <li>レスポンスデータからエラーの有無を確認する。</li>
  <li>レスポンスデータのキーは <code>'_has_err'</code> とする。</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>res</code></td>
                <td><code>Object</code></td>
                <td>レスポンスデータ</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="method-returns">
          <h4>戻り値</h4>
          <p><code>boolean</code> - エラーが存在する場合は <code>true</code></p>
        </div>
      </div>
      <div class="method">
        <h3 id="clearMsg" class="method-name">clearMsg</h3>
        <div class="method-signature">
          <code>clearMsg()</code>
        </div>
        <div class="method-description">
          メッセージクリア.<br>
<ul>
  <li>メッセージ表示エリア要素のテキストをクリアする。</li>
</ul>
  
        </div>
      </div>
      <div class="method">
        <h3 id="getValues" class="method-name">getValues</h3>
        <div class="method-signature">
          <code>getValues(outerElm)</code>
        </div>
        <div class="method-description">
          ページデータ取得.<br>
<ul>
  <li>ページ上にあるデータ送信HTML要素（<code>&lt;input&gt;</code>, <code>&lt;select&gt;</code>, <code>&lt;textarea&gt;</code>）の値を連想配列で取得する。</li>
  <li>取得するHTML要素は <code>name</code>属性が設定されているものとし、<code>name</code>属性が連想配列のキーとなる。</li>
  <li>引数の取得範囲要素が省略された場合は <code>&lt;main&gt;</code> を取得範囲とし、<code>&lt;main&gt;</code> が存在しない場合は <code>document.body</code> を取得範囲とする。</li>
  <li>主に Webサービスへのリクエストデータとして取得する。</li>
  <li>下記は通常の <code>&lt;form&gt;</code> による POST送信と異なる。
  <ul>
    <li>非活性項目も含む。</li>
    <li>スタイルによる非表示項目（<code>display:none</code> または <code>visibility:hidden</code>）は含まない。</li>
  </ul></li>
  <li>値フォーマットタイプを定義する <code>data-value-format-type</code>属性が設定されている場合は <code>UnFrmUtil</code> の該当メソッドでアンフォーマットした値を取得する。</li>
  <li>テキストボックス・テキストエリア	の場合はタブ文字や右ブランク改行コードを除去した値を取得する。</li>
  <li>チェックボックスの場合、チェックされているときは <code>value</code>属性の値を返し、チェックされていないときは <code>data-check-off-value</code>属性の値を取得する。</li>
  <li>リスト部分（繰り返し部分）のデータは配列となり１つのキーで連想配列に格納される。</li>
  <li><pre>［例］ <code>&lt;input name="user_id" value="U001"&gt;
     &lt;input name="birth_dt" value="2025/02/10"&gt;
     &lt;table&gt;...省略...&lt;tbody id="detail"&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_no" value="1"&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input name="detail.weight_kg" value="8.9"&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_no" value="2"&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input name="detail.weight_kg" value="12.1"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/tbody&gt;&lt;/table&gt;</code> は
      <code>{ user_id:'U001', birth_dt:'20250210', detail:[{pet_no:'1', weight_kg:'8.9'}, {pet_no:'2', weight_kg:'12.1'}] }</code> として取得される。</pre></li>
  <li>リスト部分の要素は下記ルールに従うこと。
  <ul> 
    <li>行内の要素（以下、行内要素と呼ぶ）は <code>name</code>属性を <code>"."</code> 区切りとし、<code>表id.項目名</code> 形式で設定する。なお <code>"."</code> 区切りの <code>name</code>属性は行内要素にのみ使用すること。</li>
    <li>行内要素の親・祖父要素として <code>"."</code> 区切りの前部分 <code>表id</code> を <code>id</code>属性とする要素（以下、表要素と呼ぶ）が存在すること。<br>
        ほとんどの場合、表要素は <code>&lt;tbody&gt;</code> または <code>&lt;table&gt;</code> となる。</li>
    <li>表要素直下の子要素は、繰り返される部分の最上位要素（以下、行要素と呼ぶ）となること。<br>
        ほとんどの場合、行要素は <code>&lt;tr&gt;</code> となる。</li>
    <li><pre>［NG例１］ 表要素が存在しない。（<code>&lt;table&gt;</code>, <code>&lt;tbody&gt;</code> のどちらにも <code>id</code>属性が無い）
      <code>&lt;table&gt;...省略...&lt;tbody&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/tbody&gt;&lt;/table&gt;</code></pre></li>
    <li><pre>［NG例２］ 表要素直下に行要素が存在しない。（<code>&lt;table&gt;</code> に <code>id</code>属性が付与されているが <code>&lt;tbody&gt;</code> が間にある）
      <code>&lt;table id="detail"&gt;...省略...&lt;tbody&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/tbody&gt;&lt;/table&gt;</code></pre></li>
    <li><pre>［OK例１］ <code>&lt;tbody&gt;</code> に <code>id</code>属性が付与されている場合は <code>&lt;tbody&gt;</code> が表要素となる。
      <code>&lt;table&gt;...省略...&lt;tbody id="detail"&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/tbody&gt;&lt;/table&gt;</code></pre></li>
    <li><pre>［OK例２］ <code>&lt;table&gt;</code> に <code>id</code>属性が付与されている場合は <code>&lt;table&gt;</code> が表要素となる。（複数個の <code>&lt;tbody&gt;</code> を使用する例）
      <code>&lt;table id="detail"&gt;...省略...
        &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;
        &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_nm"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;
      &lt;/table&gt;</code></pre></li>
  </ul></li>
  <li>行内要素には <code>data-obj-row-idx</code>属性として行インデックス値が格納され、そのインデックスに基づいて配列化される。</li>
  <li>行内のラジオボタンは <code>name</code>属性の最後の [行インデックス] を除去して戻り値のキーとする。（<code>PageUtil#setValue</code> 参照）</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>[outerElm]</code></td>
                <td><code>Object</code></td>
                <td>取得範囲要素（省略可能）</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="method-returns">
          <h4>戻り値</h4>
          <p><code>Object</code> - ページデータ連想配列（アンフォーマット済み）</p>
        </div>
      </div>
      <div class="method">
        <h3 id="getRowValues" class="method-name">getRowValues</h3>
        <div class="method-signature">
          <code>getRowValues(rowElm)</code>
        </div>
        <div class="method-description">
          行データ取得.<br>
<ul>
  <li>リスト内の１行のページデータを連想配列で取得する。</li>
  <li>データの取得ルールは <code>PageUtil#getValues</code> と同じ。</li>
  <li><code>name</code>属性の <code>"."</code> より前の部分（＝表要素の <code>id</code>属性）は除去して連想配列のキーとする。</li>
  <li><pre>［例］ <code>&lt;table&gt;...省略...&lt;tbody id="detail"&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_no" value="1"&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input name="detail.weight_kg" value="8.9"&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;input name="detail.pet_no" value="2"&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input name="detail.weight_kg" value="12.1"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/tbody&gt;&lt;/table&gt;</code> の２行目を引数に指定した場合は
      <code>{ pet_no:'2', weight_kg:'12.1' }</code> が取得される。</pre></li>
  <li>行内のラジオボタンは <code>name</code>属性の最後の [行インデックス] を除去して戻り値のキーとする。（<code>PageUtil#setValues</code> 参照）</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>rowElm</code></td>
                <td><code>Element</code></td>
                <td>行要素（通常 <code>&lt;tr&gt;</code> となる）</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="method-returns">
          <h4>戻り値</h4>
          <p><code>Object</code> - 行データ連想配列（アンフォーマット済み）</p>
        </div>
      </div>
      <div class="method">
        <h3 id="getRowValuesByInnerElm" class="method-name">getRowValuesByInnerElm</h3>
        <div class="method-signature">
          <code>getRowValuesByInnerElm(baseElm, rowTag)</code>
        </div>
        <div class="method-description">
          行データ取得.<br>
<ul>
  <li>引数の基点要素から親要素をたどって行要素（ほとんどの場合 <code>&lt;tr&gt;</code>）を取得し、その行要素のページデータを連想配列で取得する。</li>
  <li>データの取得ルールは <code>PageUtil#getRowValues</code> と同じ。</li>
</ul> 
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>baseElm</code></td>
                <td><code>Element</code></td>
                <td>基点要素</td>
              </tr>
              <tr>
                <td><code>[rowTag]</code></td>
                <td><code>string</code></td>
                <td>行要素のタグ名（省略可能）省略した場合は 'tr' とする</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="method-returns">
          <h4>戻り値</h4>
          <p><code>Object</code> - 行データ連想配列（アンフォーマット済み）</p>
        </div>
      </div>
      <div class="method">
        <h3 id="setValues" class="method-name">setValues</h3>
        <div class="method-signature">
          <code>setValues(obj, outerElm)</code>
        </div>
        <div class="method-description">
          ページデータセット.<br>
<ul>
  <li>ページ上にあるHTML要素に連想配列の値をセットする。</li>
  <li>セットするHTML要素は <code>name</code>属性または <code>data-name</code>属性が設定されているものとし、連想配列のキーが値セット先の <code>name</code>属性または <code>data-name</code>属性となる。</li>
  <li><code>&lt;span&gt;</code> や <code>&lt;td&gt;</code> など入力フォーム要素以外の（本来 <code>name</code>属性を持たない）要素に値をセットする場合は <code>data-name</code>属性を設定する。</li>
  <li><code>&lt;span&gt;</code> や <code>&lt;td&gt;</code> など <code>value</code>属性を持たないHTML要素の場合は <code>textContent</code> にセットする。</li>
  <li>引数のセット範囲要素が省略された場合は <code>&lt;main&gt;</code> をセット範囲とし、<code>&lt;main&gt;</code> が存在しない場合は <code>document.body</code> をセット範囲とする。</li>
  <li>主に Webサービスからのレスポンスデータをセットする。</li>
  <li>連想配列のキーがアンダースコア始まりの値は本フレームワークで使用する値なので本クラス外から使用不可とし本メソッドでは無視する。</li>
  <li>値フォーマットタイプを定義する <code>data-value-format-type</code>属性が設定されている場合は <code>FrmUtil</code> の該当メソッドでフォーマットした値をセットする。</li>
  <li>リスト部分のデータは連想配列内の１つのキーに配列として格納されている前提とする。</li>
  <li><pre>［例］ <code>{ user_id:'U001', birth_dt:'20250210', list:[{pet_no:'1', weight_kg:'8.9'}, {pet_no:'2', weight_kg:'12.1'}] }</code>は
    <code>&lt;input name="user_id" value="U001"&gt;
    &lt;input name="birth_dt" value="2025/02/10"&gt;
    &lt;table&gt;...省略...&lt;tbody id="detail"&gt;
      &lt;tr&gt;&lt;td data-name="detail.pet_no"&gt;1&lt;/td&gt;
          &lt;td&gt;&lt;input name="detail.weight_kg" value="8.9"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;tr&gt;&lt;td data-name="detail.pet_no"&gt;2&lt;/td&gt;
          &lt;td&gt;&lt;input name="detail.weight_kg" value="12.1"&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;/tbody&gt;&lt;/table&gt;</code> のようにセットされる。</pre></li>
  <li>リスト内の表要素、行要素、行内要素のルールは <code>PageUtil#getValues</code> と同じ。</li>
  <li>連想配列内の配列の数とリストの行数を連動させて表示したい場合は、テンプレートとなる行要素（以下、テンプレート行要素と呼ぶ）から動的に要素を生成して値をセットする。</li>
  <li>テンプレート行要素は表要素の子要素（先頭）に <code>&lt;script&gt;</code> 囲みで配置しておく。</li>
  <li><pre>［例］ 前述例の場合は下記のようにテンプレート行要素を配置する。
    <code>&lt;table&gt;...省略...&lt;tbody id="detail"&gt;
      &lt;script type="text/html"&gt;&lt;tr&gt;&lt;td data-name="detail.pet_no"&gt;&lt;/td&gt;
                                   &lt;td&gt;&lt;input name="detail.weight_kg"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/script&gt;
    &lt;/tbody&gt;&lt;/table&gt;</code></pre></li>
  <li>テンプレート行要素内のラジオボタンは <code>name</code>属性の最後に [行インデックス] を付加して行単位でグループ化する。</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>obj</code></td>
                <td><code>Object</code></td>
                <td>連想配列データ</td>
              </tr>
              <tr>
                <td><code>[outerElm]</code></td>
                <td><code>Element</code></td>
                <td>セット範囲要素（省略可能）省略した場合は <code>document.body</code> が対象となる）</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="method">
        <h3 id="addRow" class="method-name">addRow</h3>
        <div class="method-signature">
          <code>addRow(listId, obj)</code>
        </div>
        <div class="method-description">
          リスト行追加.<br>
<ul>
  <li>表要素のテンプレート行要素で行要素を生成・追加してデフォルト値をセットする。</li>
  <li>テンプレート行については <code>PageUtil#setValues</code> 参照。</li>
  <li><pre>［例］ 下記のテンプレート行の場合。
    <code>&lt;table&gt;...省略...&lt;tbody id="detail"&gt;
      &lt;script type="text/html"&gt;&lt;tr&gt;&lt;td data-name="detail.pet_no"&gt;&lt;/td&gt;
                                   &lt;td&gt;&lt;input name="detail.weight_kg"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/script&gt;
    &lt;/tbody&gt;&lt;/table&gt;</code>
    デフォルト値のキーは下記のように 表要素 <code>id</code>属性（detail.）は除いた下記となる。
   <code>{ pet_no:'1', weight_kg:'8.9' }</code>
   連想配列の配列を渡した場合は複数行追加される。
   <code>[ { pet_no:'1', weight_kg:'8.9' }, { pet_no:'2', weight_kg:'12.1' } ]</code></pre>
  </li>
  <li>デフォルト値を省略した場合は空の行要素を１行追加する。</li>
  <li>空行を複数行追加する場合は <code>new Array(n)</code> を渡す。</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>listId</code></td>
                <td><code>string</code></td>
                <td>表要素（親要素）の <code>id</code>属性（［例］ <code>'detail'</code>）</td>
              </tr>
              <tr>
                <td><code>[obj]</code></td>
                <td><code>Object|Array&lt;Object&gt;</code></td>
                <td>行追加時のデフォルト値連想配列（省略可能）</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="method">
        <h3 id="removeRow" class="method-name">removeRow</h3>
        <div class="method-signature">
          <code>removeRow(searchElmName, searchElmVal, rowTag)</code>
        </div>
        <div class="method-description">
          リスト行削除.<br>
<ul>
  <li>指定した <code>name</code>属性 かつ <code>value</code>属性を持つ要素が存在する行要素（ほとんどの場合は <code>&lt;tr&gt;</code>）を削除する。</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>searchElmName</code></td>
                <td><code>string</code></td>
                <td>検索対象要素の <code>name</code>属性（［例］ チェックボックスの場合 <code>'detail.chk'</code>）<code>data-name</code>属性は不可</td>
              </tr>
              <tr>
                <td><code>searchElmVal</code></td>
                <td><code>string</code></td>
                <td>検索対象要素の値（［例］ <code>'1'</code>）</td>
              </tr>
              <tr>
                <td><code>[rowTag]</code></td>
                <td><code>string</code></td>
                <td>行要素のタグ名（省略可能）省略した場合は <code>'tr'</code> とする</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="method-returns">
          <h4>戻り値</h4>
          <p><code>boolean</code> - 削除成功時は <code>true</code></p>
        </div>
      </div>
      <div class="method">
        <h3 id="clearRows" class="method-name">clearRows</h3>
        <div class="method-signature">
          <code>clearRows(listId)</code>
        </div>
        <div class="method-description">
          全行削除.<br>
<ul>
  <li>テンプレート行以外のすべての行要素を削除する。</li>
</ul>
        </div>
        <div class="method-parameters">
          <h4>パラメータ</h4>
          <table class="parameter-table">
            <thead>
              <tr>
                <th>名前</th>
                <th>型</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>listId</code></td>
                <td><code>string</code></td>
                <td>表要素（親要素）の <code>id</code>属性（［例］ <code>'detail'</code>）</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <p>Generated by JSDocGenerator - 2026</p>
  </div>
</body>
</html>
